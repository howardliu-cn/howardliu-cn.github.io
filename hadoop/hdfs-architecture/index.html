<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="renderer" content="webkit">
<meta http-equiv="Cache-Control" content="no-siteapp">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>HDFS架构||沉潜飞动|君子藏器于身，待时而动。</title>
<meta name="description" content="Hadoop文件存储的基础是HDFS(Hadoop Distributed File System)，HDFS的实现依赖于NameNode和DataNode，DataNode用来存储具体数据，NameNode用来管理多个DataNode中分别存储的是什么。理解起来也不难，因为HDFS是分布式的文件系统，也就是有很多机器用来存储数据，一个大文件可能分布在多个机器上，也可能是一台机器上，具体分布在哪些">
<meta name="keywords" content="hadoop,hdfs,NameNode,DataNode,Secondary NameNode">
<meta property="og:type" content="article">
<meta property="og:title" content="HDFS架构">
<meta property="og:url" content="https://www.howardliu.cn/hadoop/hdfs-architecture/index.html">
<meta property="og:site_name" content="沉潜飞动">
<meta property="og:description" content="Hadoop文件存储的基础是HDFS(Hadoop Distributed File System)，HDFS的实现依赖于NameNode和DataNode，DataNode用来存储具体数据，NameNode用来管理多个DataNode中分别存储的是什么。理解起来也不难，因为HDFS是分布式的文件系统，也就是有很多机器用来存储数据，一个大文件可能分布在多个机器上，也可能是一台机器上，具体分布在哪些">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://static.howardliu.cn/hadoop/hdfsarchitecture.gif">
<meta property="og:image" content="https://static.howardliu.cn/hadoop/hdfsdatanodes.gif">
<meta property="og:updated_time" content="2020-07-28T05:33:36.667Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HDFS架构">
<meta name="twitter:description" content="Hadoop文件存储的基础是HDFS(Hadoop Distributed File System)，HDFS的实现依赖于NameNode和DataNode，DataNode用来存储具体数据，NameNode用来管理多个DataNode中分别存储的是什么。理解起来也不难，因为HDFS是分布式的文件系统，也就是有很多机器用来存储数据，一个大文件可能分布在多个机器上，也可能是一台机器上，具体分布在哪些">
<meta name="twitter:image" content="https://static.howardliu.cn/hadoop/hdfsarchitecture.gif">

<meta name="keywords" content="hadoop,hdfs,NameNode,DataNode,Secondary NameNode">


<meta name="description" content="Hadoop文件存储的基础是HDFS(Hadoop Distributed File System)，HDFS的实现依赖于NameNode和DataNode，DataNode用来存储具体数据，NameNode用来管理多个DataNode中分别存储的是什么。理解起来也不难，因为HDFS是分布式的文件系">

<meta name="author" content="Howard Liu,howardliu1988@163.com">


<link rel="shortcut icon" href="/favicon.png" type="image/x-icon">
<link rel="icon" href="/favicon.png">

<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/theme.css">
<link rel="stylesheet" href="/css/syntax.css">
<link rel="stylesheet" href="/css/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="//cdn.bootcdn.net/ajax/libs/highlight.js/11.0.1/styles/vs2015.min.css">
<!--baidu analytics-->

<script>
    // baidu analytics
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?bbbf795fe3b264fb8122078f86cbaae5";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            
            <a class="navbar-brand" href="/.">沉潜飞动</a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                
                <li><a href="/." class="current"><i class="icon-home"> 首页</i></a></li>
                
                <li><a href="/archives/"><i class="icon-archive"> 归档</i></a></li>
                
                <li><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></li>
                
                <li><a href="/about/"><i class="icon-about"> 关于</i></a></li>
                
            </ul>
        </div>
    </div>
</nav>
<div class="wrapper">
    <div class="content">
        <div class="container container-center">
            <div class="row">
                <div class="col-md-8">
                    <div class="article">
    <div class="well">
        <h1><a href="/hadoop/hdfs-architecture/">HDFS架构</a></h1>
        <div class="post-meta">
            <div class="post-time">
                <i class="fa fa-calendar"></i><time> 2017-07-05</time>
            </div>
            <div class="post-visitors-count">
                <i class="fa fa-ge"></i>
                <span id="/hadoop/hdfs-architecture/" class="leancloud_visitors" data-flag-title="HDFS架构">
                    <span class="post-meta-item-text">阅读量 </span>
                    <i class="leancloud-visitors-count">0</i>
                </span>
            </div>
        </div>
        <div id="articleContainer" class="post-content article-entry">
            <!-- 
    <div id="toc" class="toc-content">
      <strong class="toc-title">目录</strong>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-HDFS架构"><span class="toc-text">1. HDFS架构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-文件系统"><span class="toc-text">2. 文件系统</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-数据复制"><span class="toc-text">3. 数据复制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-副本存储"><span class="toc-text">3.1 副本存储</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-副本选择"><span class="toc-text">3.2 副本选择</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-安全模式（SafeMode）"><span class="toc-text">3.3 安全模式（SafeMode）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-文件系统元数据"><span class="toc-text">4. 文件系统元数据</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-通信协议"><span class="toc-text">5. 通信协议</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-稳健性"><span class="toc-text">6. 稳健性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-数据磁盘故障，心跳和重新复制"><span class="toc-text">6.1 数据磁盘故障，心跳和重新复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-集群重新平衡"><span class="toc-text">6.2 集群重新平衡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-数据的完整性"><span class="toc-text">6.3 数据的完整性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-元数据磁盘故障"><span class="toc-text">6.4 元数据磁盘故障</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-Secondary-NameNode"><span class="toc-text">6.5 Secondary NameNode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-6-快照"><span class="toc-text">6.6 快照</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-数据"><span class="toc-text">7 数据</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-数据块"><span class="toc-text">7.1 数据块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-阶段"><span class="toc-text">7.2 阶段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-复制流水线"><span class="toc-text">7.3 复制流水线</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-易使用"><span class="toc-text">8 易使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-FS-Shell"><span class="toc-text">8.1 FS Shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-DFSAdmin"><span class="toc-text">8.2 DFSAdmin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-浏览器接口"><span class="toc-text">8.3 浏览器接口</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-空间复用"><span class="toc-text">9 空间复用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-文件删除"><span class="toc-text">9.1 文件删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-减少复制因子"><span class="toc-text">9.2 减少复制因子</span></a></li></ol></li></ol>
    </div>
 -->
            <p>前段时间搭建了一套Hadoop集群的测试环境，因为服务器故障，废了。这几天闲来无事，想着把Storm用Yarn管理起来，于是再来一遍，同时也梳理下Hadoop组件中的一些概念。所谓书读百遍其义自见，不熟的系统多搭几遍，总会熟悉了，也就是所谓的刻意练习吧。</p>
<p>先简单的说下。</p>
<p>Hadoop文件存储的基础是HDFS(Hadoop Distributed File System)，HDFS的实现依赖于NameNode和DataNode，DataNode用来存储具体数据，NameNode用来管理多个DataNode中分别存储的是什么。</p>
<p>理解起来也不难，因为HDFS是分布式的文件系统，也就是有很多机器用来存储数据，一个大文件可能分布在多个机器上，也可能是一台机器上，具体分布在哪些或哪个机器上，每块数据块的副本在哪，得需要一个总管来管理，这个总管就是NameNode，具体存储机器的就是DataNode。</p>
<p>简单的说完了，接下来就复杂的说。</p>
<a id="more"></a>
<h1 id="1-HDFS架构"><a href="#1-HDFS架构" class="headerlink" title="1. HDFS架构"></a>1. HDFS架构</h1><p>HDFS是主/从架构，一个HDFS只有一个NameNode（这里的一个是指起作用的只有一个，在NameNode的HA状态下，也是只有一个NameNode起作用，其他的NameNode节点只是备份，家有千口，主事一人嘛）。这个NameNode管理整个文件系统的命名空间（The File System Namespace），并且调节客户端对文件的访问。DataNode用来存储数据，还有一些DataNode用来管理连接到运行节点的存储。HDFS公开文件系统的命名空间，允许用户在文件系统中存储数据。</p>
<p>在HDFS内部，一个文件被分割为一个或多个数据块，这些数据块存储在一组DataNode上。NameNode负责文件系统的命名空间操作，比如对文件或文件夹执行打开、关闭，以及重命名操作，同时，也负责将数据块映射到DataNode上。DataNode负责向客户端提供对文件系统的读取和写入请求的处理。DataNode还能根据NameNode的指示，执行数据块的创建、删除和复制操作。</p>
<p><img src="https://static.howardliu.cn/hadoop/hdfsarchitecture.gif" alt="HDFS架构"></p>
<p>NameNode和DataNode通常运行在普通商用服务器上（这里是针对小型机这种又贵很又特别贵的机器说的），这些机器一般装的是Linux。HDFS使用Java实现的，而且Java号称是一处编译到处运行，也就是只要有Java环境，就能运行NameNode和DataNode。典型的部署方式是，一台机器运行NameNode，其他机器运行DataNode，每台机器一个进程。（当然也可能一台机器上有多个DataNode，但是生产环境应该不会有这种情况，毕竟没有任何好处）</p>
<p>HDFS的这种主从架构保证了，所有的数据都会从NameNode经过，这样也简化了系统的体系结构，NameNode就是老大，所有数据都经过他。当然老大也可能出现意外，就得需要其他HA的部署方式（找几个小弟时刻准备接替老大），这个后面再说。</p>
<h1 id="2-文件系统"><a href="#2-文件系统" class="headerlink" title="2. 文件系统"></a>2. 文件系统</h1><p>HDFS文件系统设计与传统分层文件系统类似，有文件夹，文件夹里可以有文件夹或文件。客户端可以对这些文件夹或文件进行操作，比如创建、删除、移动、重命名等。不过目前还不支持软连接和硬连接，后面可能会支持。</p>
<p>如前面所说，这个命名空间由NameNode维护。所有的文件/文件夹的名字、属性、复制因子都由NameNode记录。</p>
<h1 id="3-数据复制"><a href="#3-数据复制" class="headerlink" title="3. 数据复制"></a>3. 数据复制</h1><p>HDFS设计用于在大型集群中存储非常大的文件，它将每个文件存储为一组数据块块中，除了最后一块外，所有文件块大小相同（默认是64MB），HDFS通过复制数据块块进行容错，每个文件的数据块大小、复制因子都是可配的。客户端可以指定文件的副本数，可以在创建时指定，也可以在之后修改。HDFS中的文件是一次写入的，并且在任何时候都有一个明确的作者。</p>
<p>NameNode来管理所有数据块复制操作，它定期与集群中每个DataNode进行心跳和文件块报告。收到心跳意味着DataNode正常运行，文件块报告是DataNode上所有文件块的列表。</p>
<p><img src="https://static.howardliu.cn/hadoop/hdfsdatanodes.gif" alt="HDFS DataNodes"></p>
<h2 id="3-1-副本存储"><a href="#3-1-副本存储" class="headerlink" title="3.1 副本存储"></a>3.1 副本存储</h2><p>副本存储的位置对于HDFS的可靠性和性能是至关重要的，优化副本存储是HDFS与大多数其他分布式文件系统区分开来的优点之一，这是一个经过大量调整和体验的功能。机架感知副本存储策略的目的是提高数据可靠性、可用性和网络带宽的高利用率。目前的副本存储策略是朝这个方向努力的第一步。实施这一政策的短期目标是对生产系统进行验证，更多的了解其行为，并为更加复杂的策略进行测试和研究奠定基础。</p>
<p>大型的HDFS实例通常运行在多个机架上，不同机架中的两个节点之间通信必须通过交换机。通产，同一机架上的机器之间的网络速率会优于不同机架间的速率。</p>
<p>NameNode通过<a href="https://hadoop.apache.org/docs/r1.2.1/cluster_setup.html#Hadoop+Rack+Awareness" target="_blank" rel="noopener">Hadoop 机架感知</a>中介绍的方式确定每个DataNode所属的机架ID。一个简单但不是最优策略是将副本存储在不同的机架上，这样可以防止整个机架故障导致数据丢失，并允许读取数据时使用多个机架的带宽。该策略保证可以在集群中均匀分配副本，可以轻松平衡组件故障时的负载。但是，这种策略会因为需要将副本数据写到多个机架，而增加写入成本。</p>
<p>常见情况中，复制因子是3，HDFS的副本存储策略是将一个副本放置在当前机架上的一个节点上，另一个位于另一个机架上的某个节点上，最后一个放置第二个机架上的另一个节点上。这种策略减少了机架间的通信，从而提高写入性能。机架故障的概率远小于节点故障的概率，这种策略不会影响数据可靠性和可用性。但是，它会降低读取数据的网络带宽，因为数据块放置在两个机架上，而不是三个。使用这种策略，副本不会均匀的分布在机架中。还有一种比较好的策略，就是三分之一的副本在一个节点上，三分之一的副本在另一个机架上，其余的均匀分布在其他机器上，这种方式可以改善写入策略，不会影响数据可靠性或读取性能。不过这种方式还在开发中。</p>
<h2 id="3-2-副本选择"><a href="#3-2-副本选择" class="headerlink" title="3.2 副本选择"></a>3.2 副本选择</h2><p>为了最大限度的减少全局带宽消耗和读取延迟，HDFS尝试让读取器读取最接近的副本。如果在同一机架上存在副本，就优先读取该副本。如果HDFS跨越多个数据中心，则优先读取当前数据中心的副本。</p>
<h2 id="3-3-安全模式（SafeMode）"><a href="#3-3-安全模式（SafeMode）" class="headerlink" title="3.3 安全模式（SafeMode）"></a>3.3 安全模式（SafeMode）</h2><p>在启动的时候，NameNode进入一个成为安全模式的特殊状态。NameNode处于安全模式时，不会复制数据块。NameNode从DataNode节点接收心跳和数据块报告，数据块报告包含DataNode存储的数据块列表信息。每个数据块有指定的最小数量副本。当使用NameNode检入该数据块的最小副本数量时，数据块被认为是安全复制的。在NameNode检查数据块的安全复制结束后（可配的时间段，再加上30秒），NameNode退出安全模式。然后它开始检查是否有少于指定数量的数据块列表，将这些数据块复制到其他DataNode。</p>
<h1 id="4-文件系统元数据"><a href="#4-文件系统元数据" class="headerlink" title="4. 文件系统元数据"></a>4. 文件系统元数据</h1><p>HDFS由NameNode存储命名空间信息，NameNode使用名为EditLog的事务日志持续记录文件系统元数据发生的每个更改。比如，在HDFS中创建一个新的文件会导致NameNode在EditLog中插入一条记录，用于记录该操作。同样的，修改文件的复制因子也会新增一条记录。NameNode使用本机文件系统存储EditLog文件。整个文件系统命名空间（包括块映射文件和文件系统属性等信息）存储在一个名为FsImage的文件中，该文件也是存储在NameNode所在的本机文件系统中。</p>
<p>NameNode在内存中存储整个文件系统的命名空间和文件数据块映射关系，这个元数据存储模块设计为紧凑存储，可以在4GB内存的NameNode中可以支持大量的文件和文件夹。在NameNode启动时，它从磁盘读取FsImage和EditLog，将所有从EditLog的事务应用到FsImage的内存表示中，并将这个新版本的FsImage文件中。该操作会截断旧的EditLog，因为其中的事务操作已经应用到FsImage文件中。这个过程成为检查点（checkpoint）。在当前版本中，检查点操作只会发生在NameNode启动时，正在增加定期检查点检查操作。</p>
<p>DataNode将HDFS数据存储在其本地文件系统的文件中，DataNode不知道HDFS的文件数据，它只是将HDFS文件数据的数据块存储在本地文件系统中的单独文件中。DataNode不会存储同一文件夹下的所有文件，相反，它会确定每个文件夹的最佳文件数量，并适当的创建子文件夹。在同一文件夹中创建所有本地文件是不合适的，因为本地文件系统可能无法在单个文件夹中有效支持存储大量文件。当DataNode启动时，它会扫描其本地文件系统，生产与每个文件对应的所有HDFS数据块数控报告，并发送给NameNode。</p>
<h1 id="5-通信协议"><a href="#5-通信协议" class="headerlink" title="5. 通信协议"></a>5. 通信协议</h1><p>所有HDFS的通信协议是基于TCP/IP协议的。客户端通过客户端协议与NameNode建立连接，并通信。DataNode通过DataNode协议与NameNode通信。NameNode从不发起通信请求，它只响应客户端和DataNode发出的请求。</p>
<h1 id="6-稳健性"><a href="#6-稳健性" class="headerlink" title="6. 稳健性"></a>6. 稳健性</h1><p>HDFS的主要目标是可靠性存储，即使发生故障，也能够很好的支撑存储。比较常见的故障类型有：NameNode故障、DataNode故障、网络分区异常。</p>
<h2 id="6-1-数据磁盘故障，心跳和重新复制"><a href="#6-1-数据磁盘故障，心跳和重新复制" class="headerlink" title="6.1 数据磁盘故障，心跳和重新复制"></a>6.1 数据磁盘故障，心跳和重新复制</h2><p>每个DataNode会定期向NameNode发送心跳请求。网络分区可能导致一部分DataNode与NameNode失去连接，NameNode通过心跳检测这种情况，如果发现长时间没有心跳的DataNode，则标记为丢弃，而且不再转发任何新的IO请求，这些DataNode的数据也不在作用于HDFS。DataNode的死亡可能导致某些数据块的复制因子低于设定值，NameNode会不断扫描哪些数据块需要复制，并在必要的时候进行复制。重复复制可能是因为DataNode不可用、副本文件损坏、DataNode硬盘损坏，或者文件复制因子增加。</p>
<h2 id="6-2-集群重新平衡"><a href="#6-2-集群重新平衡" class="headerlink" title="6.2 集群重新平衡"></a>6.2 集群重新平衡</h2><p>HDFS架构与数据重新平衡方案兼容，如果DataNode上的可用空间低于阀值，数据会从一个DataNode移动到另一个DataNode。在对特定文件的需求突然增加的情况下，可能会动态创建其他副本来重新平衡集群中的数据。（这种类型的数据重新平衡还未实现）。</p>
<h2 id="6-3-数据的完整性"><a href="#6-3-数据的完整性" class="headerlink" title="6.3 数据的完整性"></a>6.3 数据的完整性</h2><p>DataNode存储的数据块可能会被破坏，这可能是因为存储设备故障、网络故障或软件错误导致的。HDFS客户端会对HDFS文件内容进行校验和检查。当客户端创建一个HDFS文件时，它会计算文件的每个块的检验码，然后将该校验码存储在同一HDFS命名空间中的隐藏文件中。当客户端操作文件时，会将从DataNode接收到的数据与存储的校验文件进行校验和匹配。如果没有成功，客户端会从该数据块的其他副本读取数据。</p>
<h2 id="6-4-元数据磁盘故障"><a href="#6-4-元数据磁盘故障" class="headerlink" title="6.4 元数据磁盘故障"></a>6.4 元数据磁盘故障</h2><p>FsImage和EditLog是HDFS的核心数据结构，如果这些文件被损坏，可能导致HDFS实例不可用。因此，NameNode可以配置维护FsImage和EditLog的多个副本。对FsImage或EditLog的任何更新，这些副本也跟着更新。当时这样可能会导致NameNode的TPS。但是，这种性能的降低是可以接受的，因为即使HDFS应用程序本质上是数据密集型，但却不是元数据密集型的。当NameNode重启时，它会选择最新的FsImage和EditLog使用。</p>
<p>比较常见的多备份存储是一份存在本地文件系统中，一份存储在远程网络文件系统中。</p>
<p>因为NameNode单点的，所以可能会出现HDFS集群的单点故障，需要手动干预。这个时候就需要NameNode的HA方案，这个后面再说。</p>
<h2 id="6-5-Secondary-NameNode"><a href="#6-5-Secondary-NameNode" class="headerlink" title="6.5 Secondary NameNode"></a>6.5 Secondary NameNode</h2><p>前面说过，NameNode是单点的，如果NameNode宕机，系统中的文件会丢失，所以Hadoop提供还提供了一种机制：Secondary NameNode。</p>
<p>Secondary NameNode比较有意思，它并不能直接作为NameNode使用，它只是定期将FsImage和EditLog合并，防止EditLog文件过大。通常Secondary NameNode也是运行在单独的机器上，因为日志合并操作需要占用大量的内存和CPU。Secondary NameNode会保存合并后的元数据，一旦NameNode宕机，而且元数据不可用，就可以使用Secondary NameNode备份的数据。</p>
<p>但是，Secondary NameNode总是落后与NameNode，所以在NameNode宕机后，数据丢失是不可避免的。一般这种情况就会使用元数据的远程备份与Secondary NameNode中的合并数据共同作为NameNode的元数据文件。</p>
<h2 id="6-6-快照"><a href="#6-6-快照" class="headerlink" title="6.6 快照"></a>6.6 快照</h2><p><a href="http://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/HdfsSnapshots.html" target="_blank" rel="noopener">快照功能</a>支持在特定时刻存储数据副本，可以在出现数据损坏的情况下，将HDFS回滚到之前的时间点。（目前还不支持，之后会增加）</p>
<h1 id="7-数据"><a href="#7-数据" class="headerlink" title="7 数据"></a>7 数据</h1><h2 id="7-1-数据块"><a href="#7-1-数据块" class="headerlink" title="7.1 数据块"></a>7.1 数据块</h2><p>HDFS是为了存储大文件的。与HDFS兼容的程序是处理大型数据集的，这些应用通常是一次写入，多次读取，并且要求在读取速率上满足要求。HDFS恰好满足“一次写入、多次读取”的要求。在HDFS中，数据块大小默认是64MB。所以，大文件在HDFS内存切成64MB的数据块，每个数据块会存储在不同的DataNode上。</p>
<h2 id="7-2-阶段"><a href="#7-2-阶段" class="headerlink" title="7.2 阶段"></a>7.2 阶段</h2><p>客户端创建文件的请求不会立即到达NameNode。一开始，客户端将文件缓存到临时文件中，写入操作透明的重定向到该临时文件中。当临时文件超过一个HDFS数据块的大小时，客户端将连接NameNode，NameNode会把文件名插入到文件系统中，为其分配一个数据块。NameNode使用DataNode和目标数据块响应客户端请求。然后客户端将数据块信息从本地临时文件刷新到指定的DataNode中。关闭文件时，临时文件中剩余的未刷新数据将传输到DataNode，然后，客户端通知NameNode文件关闭，此时，NameNode将文件创建操作提交到持久存储。如果NameNode在文件关闭前宕机， 则文件丢失。</p>
<p>HDFS采用上述方式是经过仔细考虑的，这些应用需要流式写入文件，如果客户端写入远程文件时没有使用客户端缓冲，网速和网络情况将会大大影响吞吐率。这种做法也是有先例的，早起的分布式文件系统也是采用这种方式，比如ASF。POSIX要求已经放宽，以便实现高性能的数据上传。</p>
<h2 id="7-3-复制流水线"><a href="#7-3-复制流水线" class="headerlink" title="7.3 复制流水线"></a>7.3 复制流水线</h2><p>如上所述，当客户端数据写入HDFS时，首先将数据写入本地缓存文件。如果HDFS文件的复制因子是3，当本地缓存文件大小累积到数据块大小时，客户端从NameNode查询写入副本的DataNode列表。然后，客户端将数据块刷新到第一个DataNode中，这个DataNode以小数据（4KB）接收数据，将数据写入本地存储库，并将该部分数据传输到第二个DataNode，第二个DataNode存储后，将数据发送给第三个DataNode。因此，DataNode可以在流水线中接收来自前一个的数据，同时将数据发送给流水线的下一个，以此类推。</p>
<h1 id="8-易使用"><a href="#8-易使用" class="headerlink" title="8 易使用"></a>8 易使用</h1><p>可以以多种方式访问HDFS，HDFS提供了一个<a href="http://hadoop.apache.org/core/docs/current/api/" target="_blank" rel="noopener">Java API</a>，C语言包装器也可用。也可以使用浏览器浏览HDFS实例文件。（目前正在通过使用WebDAV协议公开HDFS）。</p>
<h2 id="8-1-FS-Shell"><a href="#8-1-FS-Shell" class="headerlink" title="8.1 FS Shell"></a>8.1 FS Shell</h2><p>HDFS允许以文件和文件夹的形式组织数据，提供了一个名为“FS shell”的命令行界面，可让用户与HDFS中的数据进行交互。该命令集语法类似与用户熟悉的其他shell（比如bash，csh）。以下是一些实例：</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>命令</th>
</tr>
</thead>
<tbody><tr>
<td>创建/foodir文件夹</td>
<td>bin/hadoop dfs -mkdir /foodir</td>
</tr>
<tr>
<td>删除/foodir文件夹</td>
<td>bin/hadoop fs -rm -R /foodir</td>
</tr>
<tr>
<td>查看文件/foodir/myfile.txt的内容</td>
<td>bin/hadoop dfs -cat /foodir/myfile.txt</td>
</tr>
</tbody></table>
<p>FS shell针对需要脚本语言与存储数据进行交互的应用场景。</p>
<h2 id="8-2-DFSAdmin"><a href="#8-2-DFSAdmin" class="headerlink" title="8.2 DFSAdmin"></a>8.2 DFSAdmin</h2><p>DFSAdmin命令集用于管理HDFS集群，这些应该是由HDFS管理员使用的命令，以下是一些实例：</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>命令</th>
</tr>
</thead>
<tbody><tr>
<td>集群置为安全模式</td>
<td>bin/hadoop dfsadmin -safemode enter</td>
</tr>
<tr>
<td>生成DataNode列表</td>
<td>bin/hadoop dfsadmin -report</td>
</tr>
<tr>
<td>启动或停止DataNode</td>
<td>bin/hadoop dfsadmin -refreshNodes</td>
</tr>
</tbody></table>
<h2 id="8-3-浏览器接口"><a href="#8-3-浏览器接口" class="headerlink" title="8.3 浏览器接口"></a>8.3 浏览器接口</h2><p>典型的HDFS安装会配置web服务器，以配置TCP端口公开HDFS命名空间，这允许用户浏览HDFS命名空间，并使用web浏览器查看文件内容。</p>
<h1 id="9-空间复用"><a href="#9-空间复用" class="headerlink" title="9 空间复用"></a>9 空间复用</h1><h2 id="9-1-文件删除"><a href="#9-1-文件删除" class="headerlink" title="9.1 文件删除"></a>9.1 文件删除</h2><p>如果回收站功能可用，通过<a href="http://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/FileSystemShell.html#rm" target="_blank" rel="noopener">FS Shell</a>删除的文件不会立马删除，而是移动到回收站中（每个用户的回收文件夹不同，是在各自的用户目录的.Trash中，即/user/<username>/.Trash）。只要文件还保留在回收站中，就可以很快恢复。</username></p>
<p>大多数的删除文件会移动到回收站的current目录（即/user/<username>/.Trash/Current）中，在配置的时间内，HDFS创建会创建检查点（/user/<username>/.Trash/<date>），并在旧的检查点过期后删除。具体可以查看<a href="http://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/FileSystemShell.html#expunge" target="_blank" rel="noopener">删除操作</a>。</date></username></username></p>
<p>文件在回收站的时间过期后，NameNode会从HDFS命名空间中删除文件，同时，释放相关联的数据块空间。</p>
<p>文件删除后，客户端可以取消删除。可以通过浏览/trash文件夹，查找文件。/trash文件夹中包含被删除文件的最新副本。目前HDFS会从/trash删除超过6小时的文件。（/trash类似于文件系统中的回收站、垃圾桶等功能）。</p>
<p>下面是使用FS Shell删除文件的操作：</p>
<p>在当前目录中创建两个文件：test1、test2</p>
<pre><code>$ hadoop fs -mkdir -p delete/test1
$ hadoop fs -mkdir -p delete/test2
$ hadoop fs -ls delete/
Found 2 items
drwxr-xr-x   - hadoop hadoop          0 2015-05-08 12:39 delete/test1
drwxr-xr-x   - hadoop hadoop          0 2015-05-08 12:40 delete/test2</code></pre><p>删除test1：</p>
<pre><code>$ hadoop fs -rm -r delete/test1
Moved: hdfs://localhost:8020/user/hadoop/delete/test1 to trash at: hdfs://localhost:8020/user/hadoop/.Trash/Current</code></pre><p>使用<code>skipTrash</code>选项删除test2：</p>
<pre><code>$ hadoop fs -rm -r -skipTrash delete/test2
Deleted delete/test2</code></pre><p>查看回收站中的文件只有test1：</p>
<pre><code>$ hadoop fs -ls .Trash/Current/user/hadoop/delete/
Found 1 items\
drwxr-xr-x   - hadoop hadoop          0 2015-05-08 12:39 .Trash/Current/user/hadoop/delete/test1</code></pre><p>也就是test1进入回收站，test2之间删除了。</p>
<h2 id="9-2-减少复制因子"><a href="#9-2-减少复制因子" class="headerlink" title="9.2 减少复制因子"></a>9.2 减少复制因子</h2><p>当文件的复制因子减少后，NameNode选择可以删除的多余副本，在下一个心跳时将信息传输给DataNode，DataNode删除相应的数据块，并释放空间。调用setReplication API和集群使用可用空间可能会有延迟。</p>
<hr>
<p>参考</p>
<ol>
<li><a href="http://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/HdfsDesign.html" target="_blank" rel="noopener">HDFS Architecture</a></li>
</ol>
<hr>
<p>个人主页: <a href="https://www.howardliu.cn">https://www.howardliu.cn</a><br>个人博文: <a href="https://www.howardliu.cn/hadoop/hdfs-architecture/">HDFS架构</a><br>CSDN主页: <a href="http://blog.csdn.net/liuxinghao" target="_blank" rel="noopener">http://blog.csdn.net/liuxinghao</a><br>CSDN博文: <a href="http://blog.csdn.net/liuxinghao/article/details/74456146" target="_blank" rel="noopener">HDFS架构</a></p>

        </div>
        
        <div class="tags">
            
            <a href="/tags/大数据/">大数据</a>
            
            <a href="/tags/hadoop/">hadoop</a>
            
            <a href="/tags/开源/">开源</a>
            
            <a href="/tags/hdfs/">hdfs</a>
            
        </div>
        
        
        <div class="post-nav">
            
            <a class="pre" href="/hadoop/hdfs-ha-using-qjm/">
                <i class="icon-previous">使用QJM实现HDFS的HA</i>
            </a>
            
            
            <a class="next" href="/java/jvm-tuning-basic/">
                <i class="icon-next">JVM 参数优化（基础篇）</i>
            </a>
            
        </div>
        
    </div>
</div>

    <div class="well">
        <section id="comments">
            <div id="vcomment" class="comment"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine@1.3.10/dist/Valine.min.js"></script>
<script>
    new Valine({
        el: '.comment',
        notify: "false" === "true",
        verify: "false" === "true",
        visitor: "true" === "true",
        app_id: "8oLP4PUvcvP9832UMNhKJMp4-gzGzoHsz",
        app_key: "Vub5Jl1Nehop0NlWaRdWVS3S",
        placeholder: "请评论",
        avatar:"monsterid"
    });
</script>

        </section>
    </div>


<script src="https://readmore.openwrite.cn/js/readmore.js" type="text/javascript"></script>
<script>
    const btw = new BTWPlugin();
    btw.init({
        id: 'articleContainer',
        blogId: '19701-1581264117855-495',
        name: '看山的小屋',
        qrcode: 'https://www.howardliu.cn/images/mp-kanshan.jpg',
        keyword: 'vip',
    });
</script>
                </div>
                <div class="col-md-4 hidden-xs">
                    
<div class="sidebar">
    <div class="well">
        <h2>标签云</h2>
        <a href="/tags/微服务/" style="font-size: 15px;">微服务</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/线性代数/" style="font-size: 15px;">线性代数</a> <a href="/tags/矩阵/" style="font-size: 15px;">矩阵</a> <a href="/tags/矩阵乘法/" style="font-size: 15px;">矩阵乘法</a> <a href="/tags/云计算/" style="font-size: 15px;">云计算</a> <a href="/tags/概念/" style="font-size: 15px;">概念</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/双指针/" style="font-size: 15px;">双指针</a> <a href="/tags/滑动窗口/" style="font-size: 15px;">滑动窗口</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a> <a href="/tags/八皇后问题/" style="font-size: 15px;">八皇后问题</a> <a href="/tags/方法论/" style="font-size: 15px;">方法论</a> <a href="/tags/架构/" style="font-size: 15px;">架构</a> <a href="/tags/缓存/" style="font-size: 15px;">缓存</a> <a href="/tags/事件驱动/" style="font-size: 15px;">事件驱动</a> <a href="/tags/bug/" style="font-size: 15px;">bug</a> <a href="/tags/中文字符/" style="font-size: 15px;">中文字符</a> <a href="/tags/分布式/" style="font-size: 15px;">分布式</a> <a href="/tags/架构设计/" style="font-size: 15px;">架构设计</a> <a href="/tags/短链服务/" style="font-size: 15px;">短链服务</a> <a href="/tags/系统运维/" style="font-size: 15px;">系统运维</a> <a href="/tags/部署/" style="font-size: 15px;">部署</a> <a href="/tags/DevOps/" style="font-size: 15px;">DevOps</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/weblogic/" style="font-size: 15px;">weblogic</a> <a href="/tags/ModuleException/" style="font-size: 15px;">ModuleException</a> <a href="/tags/EOS/" style="font-size: 15px;">EOS</a> <a href="/tags/BPS/" style="font-size: 15px;">BPS</a> <a href="/tags/plugins/" style="font-size: 15px;">plugins</a> <a href="/tags/解决方案/" style="font-size: 15px;">解决方案</a> <a href="/tags/任务队列/" style="font-size: 15px;">任务队列</a> <a href="/tags/任务/" style="font-size: 15px;">任务</a> <a href="/tags/eclipse/" style="font-size: 15px;">eclipse</a> <a href="/tags/操作技巧/" style="font-size: 15px;">操作技巧</a> <a href="/tags/windows/" style="font-size: 15px;">windows</a> <a href="/tags/自动登录/" style="font-size: 15px;">自动登录</a> <a href="/tags/oom/" style="font-size: 15px;">oom</a> <a href="/tags/MQ/" style="font-size: 15px;">MQ</a> <a href="/tags/RabbitMQ/" style="font-size: 15px;">RabbitMQ</a> <a href="/tags/os/" style="font-size: 15px;">os</a> <a href="/tags/ssh/" style="font-size: 15px;">ssh</a> <a href="/tags/passwordless/" style="font-size: 15px;">passwordless</a> <a href="/tags/CD/" style="font-size: 15px;">CD</a> <a href="/tags/code-quality/" style="font-size: 15px;">code quality</a> <a href="/tags/SonarQube/" style="font-size: 15px;">SonarQube</a> <a href="/tags/Jenkins-Pipeline/" style="font-size: 15px;">Jenkins Pipeline</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/ufw/" style="font-size: 15px;">ufw</a> <a href="/tags/iptable/" style="font-size: 15px;">iptable</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/authority/" style="font-size: 15px;">authority</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/Phoenix/" style="font-size: 15px;">Phoenix</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/go/" style="font-size: 15px;">go</a> <a href="/tags/开发指南/" style="font-size: 15px;">开发指南</a> <a href="/tags/Dockerfile/" style="font-size: 15px;">Dockerfile</a> <a href="/tags/大数据/" style="font-size: 15px;">大数据</a> <a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/yarn/" style="font-size: 15px;">yarn</a> <a href="/tags/开源/" style="font-size: 15px;">开源</a> <a href="/tags/hdfs/" style="font-size: 15px;">hdfs</a> <a href="/tags/rm/" style="font-size: 15px;">rm</a> <a href="/tags/ha/" style="font-size: 15px;">ha</a> <a href="/tags/QJM/" style="font-size: 15px;">QJM</a> <a href="/tags/mapreduce/" style="font-size: 15px;">mapreduce</a> <a href="/tags/hbase/" style="font-size: 15px;">hbase</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/jvm/" style="font-size: 15px;">jvm</a> <a href="/tags/gc/" style="font-size: 15px;">gc</a> <a href="/tags/http-状态码/" style="font-size: 15px;">http 状态码</a> <a href="/tags/ArrayList/" style="font-size: 15px;">ArrayList</a> <a href="/tags/线程安全/" style="font-size: 15px;">线程安全</a> <a href="/tags/模式/" style="font-size: 15px;">模式</a> <a href="/tags/ipv4/" style="font-size: 15px;">ipv4</a> <a href="/tags/int/" style="font-size: 15px;">int</a> <a href="/tags/Effective-Java/" style="font-size: 15px;">Effective Java</a> <a href="/tags/工具/" style="font-size: 15px;">工具</a> <a href="/tags/EasyExcel/" style="font-size: 15px;">EasyExcel</a> <a href="/tags/注释/" style="font-size: 15px;">注释</a> <a href="/tags/开发/" style="font-size: 15px;">开发</a> <a href="/tags/规范/" style="font-size: 15px;">规范</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Java8/" style="font-size: 15px;">Java8</a> <a href="/tags/optional/" style="font-size: 15px;">optional</a> <a href="/tags/Java9/" style="font-size: 15px;">Java9</a> <a href="/tags/Java10/" style="font-size: 15px;">Java10</a> <a href="/tags/concurrency/" style="font-size: 15px;">concurrency</a> <a href="/tags/thread/" style="font-size: 15px;">thread</a> <a href="/tags/synchronized/" style="font-size: 15px;">synchronized</a> <a href="/tags/Date/" style="font-size: 15px;">Date</a> <a href="/tags/Time/" style="font-size: 15px;">Time</a> <a href="/tags/JDK8/" style="font-size: 15px;">JDK8</a> <a href="/tags/Comparator/" style="font-size: 15px;">Comparator</a> <a href="/tags/import/" style="font-size: 15px;">import</a> <a href="/tags/jdk/" style="font-size: 15px;">jdk</a> <a href="/tags/stream/" style="font-size: 15px;">stream</a> <a href="/tags/collectors/" style="font-size: 15px;">collectors</a>
    </div>
</div>

<div class="sidebar ">
    <div class="well">
        <h2>最新文章</h2>
        <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/java-10-features/">Java 每半年就会更新一次新特性，再不掌握就要落伍了：Java10 的新特性</a></li><li class="post-list-item"><a class="post-list-link" href="/mybatis-plus-conflict-noclassdeffounderror/">Mybatis-Plus 版本冲突触发“Could not convert argument value of type [java.lang.String] to required type [java.lang.Class]”的 java.lang.NoClassDefFoundError 异常</a></li><li class="post-list-item"><a class="post-list-link" href="/java-9-features/">Java 每半年就会更新一次新特性，再不掌握就要落伍了：Java9 的新特性</a></li><li class="post-list-item"><a class="post-list-link" href="/avoid-the-distributed-monolith/">微服务架构的陷阱：从单体到分布式单体</a></li><li class="post-list-item"><a class="post-list-link" href="/from-monolith-to-microservices-2/">如何实现单体架构到微服务架构的蜕变？</a></li><li class="post-list-item"><a class="post-list-link" href="/do-we-have-any-other-options-besides-microservices/">除了微服务，我们还有其他选择吗？</a></li><li class="post-list-item"><a class="post-list-link" href="/java-8-features/">Java 每半年就会更新一次新特性，再不掌握就要落伍了：Java8 的新特性</a></li><li class="post-list-item"><a class="post-list-link" href="/strategy-pattern/">人人都会设计模式：策略模式</a></li><li class="post-list-item"><a class="post-list-link" href="/java-lambda-powerful-comparation/">Java 进阶：使用 Lambda 表达式实现超强的排序功能</a></li><li class="post-list-item"><a class="post-list-link" href="/effective-java-tools-batch-rename-baiduwangpan/">看山聊 Java：从零实现“百度网盘批量重命名”工具</a></li></ul>
    </div>
</div>

<div class="sidebar">
    <div class="well">
        <h2>归档</h2>
        <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">2021年12月</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">2021年11月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">2021年10月</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">2021年09月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">2021年08月</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">2021年07月</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">2021年06月</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">2021年05月</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">2021年04月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">2021年03月</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">2021年02月</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">2021年01月</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">2020年12月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">2020年09月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">2020年08月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">2020年07月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">2020年03月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">2020年02月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">2020年01月</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">2019年11月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">2019年10月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">2017年10月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">2017年09月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">2017年08月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">2017年07月</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">2017年06月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">2017年04月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">2017年03月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">2017年02月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">2016年08月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">2016年07月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">2016年05月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">2016年03月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">2016年01月</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">2015年12月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">2015年11月</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">2015年09月</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">2015年04月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">2015年03月</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">2015年02月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">2015年01月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">2014年12月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">2014年10月</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">2014年09月</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">2014年07月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">2014年06月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">2013年10月</a><span class="archive-list-count">1</span></li></ul>
    </div>
</div>


                </div>
            </div>
        </div>
    </div>
    <div class="side-button-wrap">
        <a id="to-top" class="side-button icon-up-arrow" href="#top"></a>
        <a id="to-home" class="side-button icon-home" href="/."></a>
        <a id="to-comment-button" class="side-button icon-msg" href="#comment"></a>
        <a id="to-bottom-button" class="side-button icon-down-arrow" href="#bottom"></a>
    </div>
    <a id="bottom" name="bottom"></a>
    <footer id="footer" class="footer-distributed" style="background-color: #222222;">
    <div class="container">
        <div class="footer">
            <p>Howard Liu &copy; 2021</p>
            <ul class="social-media">
                
                <li>
                    <a title="github" href="https://github.com/howardliu-cn" target="_blank">
                        <i class="fa fa-github fa-2x"></i>
                    </a>
                </li>
                
                <li>
                    <a title="StackOverflow" href="http://stackoverflow.com/users/4417033" target="_blank">
                        <i class="fa fa-stack-overflow fa-2x"></i>
                    </a>
                </li>
                
                
                <li>
                    <a title="E-mail" href="mailto:howardliu1988@163.com">
                        <i class="fa fa-envelope fa-2x"></i>
                    </a>
                </li>
                
                <li>
                    <a title="hexo-theme-clean-dark" href="https://github.com/howardliu-cn/hexo-theme-clean-dark" target="_blank">
                        <i class="fa fa-film fa-2x"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</footer>

</div>
<script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="//cdn.bootcdn.net/ajax/libs/highlight.js/11.0.1/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="/js/header.js"></script>
<script src="/js/toc.js"></script>
<!--[if lt IE 9]>
<script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
![endif]-->
<!--fancybox-->

<script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script>
<script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js"></script>
<link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">
<script>
    $(document).ready(function () {
        $("img").each(function (index, item) {
            var p = $(item).parents()[0];
            if($(p).is('a')) {
                $(p).fancybox();
                return;
            }
            $(p).append(function() {return "<a id='fancybox_id_"+index+"' href='" + $(item).attr("src") + "'></a>";});
            item.remove();
            var fancyboxItem = $("#fancybox_id_" + index);
            fancyboxItem.append($(item));
            fancyboxItem.fancybox();
        });
    });
</script>

<!--baidu auto-push-->

    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
        </script>

<!--google analytics-->

<script>
    // google analytics
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-72122926-1', 'auto');
    ga('send', 'pageview');
</script>


<script color="255,255,255" opacity="0.9" zindex="-1" count="150" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>